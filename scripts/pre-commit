#!/bin/bash
# Pre-commit hook for MyTree
# Runs linting checks before allowing commits

set -e

echo "ðŸ” Running pre-commit checks..."

# Get the project root directory
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

# Run all linting checks via Makefile
# This includes: SwiftLint, whitespace checks, markdown linting, spelling, and links
echo "Running lint checks..."
make lint

# Check Swift syntax for staged Swift files (additional safety check)
echo "ðŸ”§ Checking Swift syntax for staged files..."
SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "\.swift$" || true)

if [ -n "$SWIFT_FILES" ]; then
    for file in $SWIFT_FILES; do
        if [ -f "$file" ]; then
            if ! xcrun swiftc -parse "$file" > /dev/null 2>&1; then
                echo "âŒ Syntax error in $file"
                xcrun swiftc -parse "$file" 2>&1 | head -5
                exit 1
            fi
        fi
    done
    echo "âœ… Swift syntax check passed"
fi

echo ""
echo "âœ… All pre-commit checks passed!"
exit 0
